package com.aurionpro.main.controller;

import org.springframework.web.bind.annotation.*;

import com.aurionpro.main.captcha.CaptchaGenerator;
import com.aurionpro.main.captcha.CaptchaSettings;

import cn.apiclub.captcha.Captcha;

@RestController
@RequestMapping("/app")
public class CaptchaController {

  // Endpoint to get the captcha
  @GetMapping("/generateCaptcha")
  public CaptchaSettings generateCaptcha() {
      return genCaptcha();
  }

  // Endpoint to verify the captcha
  @PostMapping("/verifyCaptcha")
  public String verifyCaptcha(@RequestBody CaptchaSettings captchaSettings) {
      if (captchaSettings.getCaptcha().equals(captchaSettings.getHiddenCaptcha())) {
          return "Captcha verified successfully";
      } else {
          return "Invalid Captcha";
      }
  }

  // Helper method to generate captcha settings
  private CaptchaSettings genCaptcha() {
      CaptchaSettings captchaSettings = new CaptchaSettings();
      Captcha captcha = CaptchaGenerator.generateCaptcha(260, 80);
      captchaSettings.setHiddenCaptcha(captcha.getAnswer());
      captchaSettings.setCaptcha(""); // This will be filled by the user in Postman
      captchaSettings.setRealCaptcha(CaptchaGenerator.encodeCaptchatoBinary(captcha));
      return captchaSettings;
  }
}
